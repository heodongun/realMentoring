<div class="row movie-details mb-5">
  <div class="col-md-4 mb-4">
    <% if (movie.posterPath) { %>
      <img src="<%= movie.isExternalPoster ? movie.posterPath : movie.posterPath %>" class="img-fluid rounded poster-lg" alt="<%= movie.title %> 포스터">
    <% } else { %>
      <div class="bg-secondary d-flex justify-content-center align-items-center" style="height: 400px;">
        <i class="fas fa-film fa-5x text-white"></i>
      </div>
    <% } %>
    <div class="d-flex justify-content-between mt-3">
      <a href="/edit-movie/<%= movie._id %>" class="btn btn-warning">
        <i class="fas fa-edit"></i> 수정
      </a>
      <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteMovieModal">
        <i class="fas fa-trash"></i> 삭제
      </button>
    </div>
  </div>
  
  <div class="col-md-8">
    <h1 class="display-5 mb-3"><%= movie.title %></h1>
    
    <div class="rating-stars mb-3">
      <% for(let i = 1; i <= 5; i++) { %>
        <% if (i <= Math.round(movie.rating)) { %>
          <i class="fas fa-star fa-2x"></i>
        <% } else { %>
          <i class="far fa-star fa-2x"></i>
        <% } %>
      <% } %>
      <span class="ms-2 fs-4"><%= movie.rating %>/5</span>
      <span class="badge bg-primary ms-2 fs-5"><%= movie.reviewCount %> 리뷰</span>
    </div>
    
    <div class="movie-info mb-4">
      <p><strong>감독:</strong> <%= movie.director %></p>
      <p><strong>개봉년도:</strong> <%= movie.year %></p>
      <p><strong>장르:</strong> <%= movie.genre %></p>
      <p class="mt-3"><%= movie.synopsis %></p>
    </div>
    
    <div class="review-section">
      <h3 class="mb-4">리뷰 작성</h3>
      <form action="/add-review/<%= movie._id %>" method="POST" class="mb-5">
        <div class="mb-3">
          <label for="author" class="form-label">이름</label>
          <input type="text" class="form-control" id="author" name="author" required>
        </div>
        <div class="mb-3">
          <label for="rating" class="form-label">평점</label>
          <select class="form-select" id="rating" name="rating" required>
            <option value="">평점 선택</option>
            <option value="5">5점 - 최고예요!</option>
            <option value="4">4점 - 좋아요</option>
            <option value="3">3점 - 보통이에요</option>
            <option value="2">2점 - 별로예요</option>
            <option value="1">1점 - 싫어요</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="content" class="form-label">리뷰 내용</label>
          <textarea class="form-control" id="content" name="content" rows="4" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">리뷰 등록</button>
      </form>
      
      <h3 class="mb-4">리뷰 목록 (<%= reviews.length %>)</h3>
      
      <% if (reviews.length > 0) { %>
        <% reviews.forEach(review => { %>
          <div class="card review-card mb-3">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="card-title mb-0"><%= review.author %></h5>
                <div>
                  <span class="rating-stars me-2">
                    <% for(let i = 1; i <= 5; i++) { %>
                      <% if (i <= review.rating) { %>
                        <i class="fas fa-star"></i>
                      <% } else { %>
                        <i class="far fa-star"></i>
                      <% } %>
                    <% } %>
                  </span>
                  <small class="text-muted"><%= new Date(review.createdAt).toLocaleDateString() %></small>
                </div>
              </div>
              <p class="card-text"><%= review.content %></p>
              <form action="/delete-review/<%= review._id %>" method="POST" class="text-end">
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  <i class="fas fa-trash"></i> 삭제
                </button>
              </form>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="alert alert-info">
          아직 리뷰가 없습니다. 첫 리뷰를 작성해보세요!
        </div>
      <% } %>
    </div>
  </div>
</div>

<!-- 영화 삭제 확인 모달 -->
<div class="modal fade" id="deleteMovieModal" tabindex="-1" aria-labelledby="deleteMovieModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteMovieModalLabel">영화 삭제 확인</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p><strong><%= movie.title %></strong> 영화를 삭제하시겠습니까?</p>
        <p class="text-danger">이 작업은 되돌릴 수 없으며, 모든 리뷰도 함께 삭제됩니다.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
        <form action="/delete-movie/<%= movie._id %>" method="POST">
          <button type="submit" class="btn btn-danger">삭제</button>
        </form>
      </div>
    </div>
  </div>
</div>